<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alani Inventory System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb; --secondary: #64748b;
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
            --bg: #f1f5f9; --card-bg: #ffffff; --text-dark: #1e293b;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-dark); margin: 0; padding: 0; }

        /* --- NAVBAR --- */
        .navbar {
            background: var(--card-bg); padding: 15px 30px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
        }
        .navbar h1 { margin: 0; font-size: 1.25rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .user-badge { background: var(--primary); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }

        /* --- CONTAINER --- */
        .container { max-width: 1280px; margin: 30px auto; padding: 0 20px; }

        /* --- STAT CARDS --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card {
            background: var(--card-bg); padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border-left: 5px solid var(--secondary);
        }
        .stat-card.stok-mentah { border-left-color: var(--primary); }
        .stat-card.stok-matang { border-left-color: var(--warning); }
        .stat-card.penjualan-bulan { border-left-color: var(--success); }
        
        .stat-title { font-size: 0.75rem; color: var(--secondary); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-size: 1.5rem; font-weight: 800; margin-top: 5px; }

        /* --- MAIN LAYOUT --- */
        .content-grid { display: grid; grid-template-columns: 350px 1fr; gap: 25px; }

        .card { background: var(--card-bg); border-radius: 16px; padding: 25px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .card-header { font-size: 1.1rem; font-weight: 700; margin-bottom: 20px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
        
        /* Form */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; }
        select, input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }

        .btn-action { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn-submit { background: var(--primary); color: white; }
        .btn-download { background: var(--success); color: white; }
        .btn-reset { background: #f1f5f9; color: #64748b; font-size: 0.8rem; }

        /* Charts */
        .chart-container { height: 250px; margin-bottom: 20px; }

        /* Table */
        .table-wrapper { overflow-y: auto; max-height: 450px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { background: #f8fafc; padding: 12px; text-align: left; position: sticky; top: 0; color: var(--secondary); font-weight: 700; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .tag { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; }
        .tag-in { background: #d1fae5; color: #065f46; }
        .tag-out { background: #fee2e2; color: #991b1b; }

        @media (max-width: 768px) {
            .content-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<nav class="navbar">
    <h1>ü•ö Alani Inventory System</h1>
    <div class="user-badge" id="tanggalHariIni">3 Feb 2026</div>
</nav>

<div class="container">
    <div class="dashboard-grid">
        <div class="stat-card stok-mentah">
            <div class="stat-title">Stok Mentah</div>
            <div class="stat-value" id="sisaMentah">0 Kg</div>
            <div id="subMentah" style="font-size: 0.75rem; color: var(--secondary); margin-top: 5px;">In: 0 | Out: 0</div>
        </div>
        <div class="stat-card stok-matang">
            <div class="stat-title">Stok Matang</div>
            <div class="stat-value" id="sisaMatang">0 Kg</div>
            <div id="subMatang" style="font-size: 0.75rem; color: var(--secondary); margin-top: 5px;">In: 0 | Out: 0</div>
        </div>
        <div class="stat-card penjualan-bulan">
            <div class="stat-title">Penjualan Bulan Ini</div>
            <div class="stat-value" id="jualBulan" style="color: var(--success);">0 Kg</div>
            <div style="font-size: 0.75rem; color: var(--secondary); margin-top: 5px;" id="namaBulan">Februari 2026</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Total Transaksi</div>
            <div class="stat-value" id="totalTrx">0</div>
            <div style="font-size: 0.75rem; color: var(--secondary); margin-top: 5px;">Data tersimpan</div>
        </div>
    </div>

    <div class="content-grid">
        <div>
            <div class="card">
                <div class="card-header">üìù Input Transaksi</div>
                <div class="form-group">
                    <label>Kategori Produk</label>
                    <select id="kategori">
                        <option value="Mentah">ü•ö Putih Telur Mentah</option>
                        <option value="Matang">üç≥ Putih Telur Matang</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Jenis Aktivitas</label>
                    <select id="status">
                        <option value="Masuk">‚¨áÔ∏è Pembelian (Masuk)</option>
                        <option value="Keluar">‚¨ÜÔ∏è Penjualan (Keluar)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Jumlah Berat (Kg)</label>
                    <input type="number" id="jumlah" placeholder="Contoh: 10">
                </div>
                <button class="btn-action btn-submit" onclick="prosesData()">Simpan Data</button>
                <button class="btn-action btn-download" onclick="downloadCSV()">üìÇ Export Laporan (Excel)</button>
                <button class="btn-action btn-reset" onclick="resetData()">Reset Sistem</button>
            </div>

            <div class="card">
                <div class="card-header">üìä Perbandingan In/Out</div>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">üìú Riwayat Transaksi</div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Kategori</th>
                            <th>Status</th>
                            <th style="text-align:right;">Jumlah</th>
                        </tr>
                    </thead>
                    <tbody id="logTabel"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('db_alani_v1')) || {
        mentah: { in: 0, out: 0 },
        matang: { in: 0, out: 0 },
        logs: []
    };

    const skrg = new Date();
    document.getElementById('tanggalHariIni').innerText = skrg.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
    document.getElementById('namaBulan').innerText = skrg.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });

    const ctx = document.getElementById('mainChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Mentah In', 'Mentah Out', 'Matang In', 'Matang Out'],
            datasets: [{
                data: [0, 0, 0, 0],
                backgroundColor: ['#2563eb', '#ef4444', '#f59e0b', '#dc2626'],
                borderRadius: 5
            }]
        },
        options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });

    function updateUI() {
        const sisaM = db.mentah.in - db.mentah.out;
        const sisaT = db.matang.in - db.matang.out;

        const bulanIni = skrg.getMonth();
        const tahunIni = skrg.getFullYear();
        let totalJualBulan = 0;

        db.logs.forEach(log => {
            const tglLog = new Date(log.isoDate);
            if (log.stat === 'Keluar' && tglLog.getMonth() === bulanIni && tglLog.getFullYear() === tahunIni) {
                totalJualBulan += log.qty;
            }
        });

        document.getElementById('sisaMentah').innerText = sisaM.toLocaleString('id-ID') + " Kg";
        document.getElementById('subMentah').innerText = `In: ${db.mentah.in} | Out: ${db.mentah.out}`;
        document.getElementById('sisaMatang').innerText = sisaT.toLocaleString('id-ID') + " Kg";
        document.getElementById('subMatang').innerText = `In: ${db.matang.in} | Out: ${db.matang.out}`;
        document.getElementById('jualBulan').innerText = totalJualBulan.toLocaleString('id-ID') + " Kg";
        document.getElementById('totalTrx').innerText = db.logs.length;

        myChart.data.datasets[0].data = [db.mentah.in, db.mentah.out, db.matang.in, db.matang.out];
        myChart.update();

        document.getElementById('logTabel').innerHTML = db.logs.map(row => `
            <tr>
                <td style="color: #64748b; font-weight: 500;">${row.tanggal}</td>
                <td><b>${row.kat}</b></td>
                <td><span class="tag ${row.stat === 'Masuk' ? 'tag-in' : 'tag-out'}">${row.stat.toUpperCase()}</span></td>
                <td style="text-align:right; font-weight:bold;">${row.qty.toLocaleString('id-ID')} Kg</td>
            </tr>
        `).join('');
    }

    function prosesData() {
        const kat = document.getElementById('kategori').value;
        const stat = document.getElementById('status').value;
        const qty = parseFloat(document.getElementById('jumlah').value);

        if (!qty || qty <= 0) return alert("Masukkan jumlah berat!");

        if (kat === 'Mentah') {
            stat === 'Masuk' ? db.mentah.in += qty : db.mentah.out += qty;
        } else {
            stat === 'Masuk' ? db.matang.in += qty : db.matang.out += qty;
        }

        const tgl = new Date();
        db.logs.unshift({
            isoDate: tgl.toISOString(),
            tanggal: tgl.toLocaleDateString('id-ID', { day: '2-digit', month: 'short' }),
            kat: kat,
            stat: stat,
            qty: qty
        });

        localStorage.setItem('db_alani_v1', JSON.stringify(db));
        document.getElementById('jumlah').value = '';
        updateUI();
    }

    function downloadCSV() {
        if(db.logs.length === 0) return alert("Belum ada data!");

        let totalMasuk = 0;
        let totalKeluar = 0;
        let csv = "\uFEFFTanggal;Kategori;Status;Jumlah(Kg)\n";
        
        db.logs.forEach(r => {
            csv += `${r.tanggal};${r.kat};${r.stat};${r.qty}\n`;
            if(r.stat === 'Masuk') totalMasuk += r.qty;
            if(r.stat === 'Keluar') totalKeluar += r.qty;
        });

        csv += "\n";
        csv += `;;TOTAL MASUK;${totalMasuk}\n`;
        csv += `;;TOTAL KELUAR;${totalKeluar}\n`;
        csv += `;;SISA STOK;${totalMasuk - totalKeluar}\n`;

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.setAttribute("download", `Laporan_Alani_${new Date().toLocaleDateString('id-ID')}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function resetData() {
        if(confirm("Hapus semua data sistem?")) {
            localStorage.removeItem('db_alani_v1');
            location.reload();
        }
    }

    updateUI();
</script>
</body>
</html>